# Архитектурное решение для системы кэширования

## 1. Мотивация внедрения

### 1.1 Технические преимущества
- **Снижение нагрузки на БД** - уменьшение количества запросов к базам данных
- **Улучшение отзывчивости UI** - операторы быстрее получают информацию о новых заказах
- **Оптимизация ресурсов** - снижение нагрузки на бекенд и серверы статики
- **Ускорение работы системы** - избегание затратных операций с СУБД

### 1.2 Бизнес-преимущества
- Уменьшение негатива от пользователей за счет быстрой работы
- Решение проблемы медленной загрузки дашборда MES (критично для операторов)

## 2. Области применения кэширования

| Компонент | Что кэшируется | Тип кэширования |
|-----------|----------------|-----------------|
| Shop UI | JS файлы 3D редактора | Клиентское (долгосрочное) |
| Shop UI | Данные заказов | Клиентское (5-10 сек) |
| MES API | Словари и справочная информация | Серверное (SoftReference) |
| MES API | Список новых заказов | Write-behind |
| Shop API | Витрины и модели клиентов | Cache-Aside |
| CRM API | Данные по клиентам | Read-Through |
| БД | Операции записи | Write-Through |
| 3D files storage | Модели | Read-Through |

## 3. Паттерны кэширования

### 3.1 Cache-Aside
**Применение**: Shop API, магазин
**Обоснование**: Простая реализация, легкий контроль, Spring фреймворки поддерживают из коробки

### 3.2 Read-Through
**Применение**: Внутренние API (CRM, MES для чтения), 3D storage
**Обоснование**: Автоматическая загрузка данных при промахе

### 3.3 Write-Through
**Применение**: БД, внешние пользователи API
**Обоснование**: Гарантия консистентности данных

### 3.4 Write-Behind
**Применение**: Новые заказы в MES
**Обоснование**: Максимально быстрая доступность информации для операторов

## 4. Стратегии инвалидации

### 4.1 Временная инвалидация
- **Заказы**: актуальность данных в течение определенного времени
- **Нечувствительные данные**: редко меняющаяся информация
- **Не подходит**: для 3D моделей и внутренних API

### 4.2 Инвалидация по ключу
- **Словари в MES API**: при обновлении через интерфейс
- **API операции**: точечная инвалидация
- **Не подходит**: для магазина (неэффективно)

### 4.3 Инвалидация на основе запросов
- **Магазин и CRM**: после оплаты заказа, изменения статуса
- **Пример**: инвалидация страницы заказа после успешной оплаты

### 4.4 Программная инвалидация
- **Приоритет**: если Spring предоставляет решение из коробки
- **Альтернатива**: переход на инвалидацию по ключу при отсутствии готовых решений

## 5. Операции с кэшем

### 5.1 Чтение списка заказов (MES)
1. Operator → MES UI → MES API (Read-Through cache)
2. Cache hit → возврат данных
3. Cache miss → запрос к БД (Write-Through) + CRM API (Read-Through)
4. Сохранение в кэш → возврат данных

### 5.2 Изменение статуса заказа
1. Operator → MES UI → MES API
2. Запись в БД через Write-Through
3. Инвалидация кэша заказов
4. Обновление в CRM API
5. Инвалидация связанных кэшей

## 6. Ожидаемые результаты

- **Ускорение загрузки дашборда MES** - критично для работы операторов
- **Снижение нагрузки на БД** на 60-80% для операций чтения
- **Улучшение времени отклика** для внешних API пользователей
- **Оптимизация трафика** за счет долгосрочного кэширования статики